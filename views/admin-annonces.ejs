 <!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion Annonces - Admin</title>
  <link rel="stylesheet" href="/css/style.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="admin-dashboard">
  <header class="admin-header">
    <div class="logo" style="position: absolute; left: 2rem; top: 50%; transform: translateY(-50%);">
      <img src="/images/LOGO_AFRIKMARKET.jpg" alt="AfrikMarket Logo" style="height: 40px;">
    </div>
    <h1><i class="fas fa-bullhorn"></i> Gestion des Annonces</h1>
    <nav class="admin-nav">
      <a href="/admin"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="/admin/users"><i class="fas fa-users"></i> Gérer Utilisateurs</a>
      <form action="/logout" method="POST" style="display:inline;">
        <button type="submit" class="btn-admin" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);">
          <i class="fas fa-sign-out-alt"></i> Déconnexion
        </button>
      </form>
    </nav>
  </header>

  <main class="admin-main">
    <div class="admin-table-section">
      <h2><i class="fas fa-list"></i> Liste des Annonces (<%= annonces.length %>)</h2>
      <table class="admin-table">
        <thead>
          <tr>
            <th><i class="fas fa-heading"></i> Titre</th>
            <th><i class="fas fa-user"></i> Auteur</th>
            <th><i class="fas fa-euro-sign"></i> Prix</th>
            <th><i class="fas fa-tag"></i> Catégorie</th>
            <th><i class="fas fa-map-marker-alt"></i> Lieu</th>
            <th><i class="fas fa-info-circle"></i> Statut</th>
            <th><i class="fas fa-calendar"></i> Date</th>
            <th><i class="fas fa-cogs"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          <% annonces.forEach(annonce => { %>
            <tr>
              <td>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                  <% if (annonce.images && annonce.images.length > 0) { %>
                    <img src="<%= annonce.images[0] %>" alt="<%= annonce.title %>" style="width: 40px; height: 40px; object-fit: cover; border-radius: 6px; border: 2px solid #e9ecef;">
                  <% } else { %>
                    <div style="width: 40px; height: 40px; background: #f8f9fa; border-radius: 6px; display: flex; align-items: center; justify-content: center; border: 2px solid #e9ecef;">
                      <i class="fas fa-image" style="color: #ccc;"></i>
                    </div>
                  <% } %>
                  <a href="/annonce/<%= annonce._id %>" style="color: #667eea; font-weight: 500;"><%= annonce.title %></a>
                </div>
              </td>
              <td>
                <% if (annonce.user) { %>
                  <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="width: 24px; height: 24px; border-radius: 50%; background: #667eea; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.8rem; font-weight: bold;">
                      <%= annonce.user.name.charAt(0).toUpperCase() %>
                    </div>
                    <%= annonce.user.name %>
                  </div>
                <% } else { %>
                  <em style="color: #999;">Utilisateur supprimé</em>
                <% } %>
              </td>
              <td><strong style="color: #28a745; font-size: 1.1rem;"><%= annonce.price %> €</strong></td>
              <td>
                <span style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold;">
                  <i class="fas fa-tag"></i> <%= annonce.category %>
                </span>
              </td>
              <td>
                <i class="fas fa-map-marker-alt" style="color: #dc3545;"></i> <%= annonce.location %>
              </td>
              <td>
                <% if (annonce.status === 'pending') { %>
                  <span style="background: #ffc107; color: #000; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">
                    <i class="fas fa-clock"></i> En attente
                  </span>
                <% } else if (annonce.status === 'approved') { %>
                  <span style="background: #28a745; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">
                    <i class="fas fa-check"></i> Approuvée
                  </span>
                <% } else if (annonce.status === 'rejected') { %>
                  <span style="background: #dc3545; color: white; padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; font-weight: bold;">
                    <i class="fas fa-times"></i> Rejetée
                  </span>
                <% } %>
              </td>
              <td><%= annonce.createdAt.toLocaleDateString('fr-FR') %></td>
              <td>
                <% if (annonce.status === 'pending') { %>
                  <form action="/admin/annonces/<%= annonce._id %>/approve" method="POST" style="display:inline;">
                    <button type="submit" class="btn-admin" style="font-size: 0.8rem; padding: 0.4rem 0.8rem; background: #28a745;">
                      <i class="fas fa-check"></i> Approuver
                    </button>
                  </form>
                  <form action="/admin/annonces/<%= annonce._id %>/reject" method="POST" style="display:inline;">
                    <input type="text" name="comment" placeholder="Commentaire (optionnel)" style="width: 120px; padding: 0.2rem; margin: 0 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.8rem;">
                    <button type="submit" class="btn-admin btn-danger" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                      <i class="fas fa-times"></i> Rejeter
                    </button>
                  </form>
                <% } else { %>
                  <form action="/admin/annonces/<%= annonce._id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette annonce ? Cette action est irréversible.')">
                    <button type="submit" class="btn-admin btn-danger" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                      <i class="fas fa-trash"></i> Supprimer
                    </button>
                  </form>
                <% } %>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </main>

  <footer>
    <p>&copy; 2024 AfrikMarket. Tous droits réservés.</p>
    <a href="/">Accueil</a>
    <a href="/contact">Contact</a>
    <a href="/about">À propos</a>
  </footer>

  <script src="/js/main.js"></script>
</body>
</html>
